<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Titration Predictor — Burette & Extracted Acetic Acid</title>
    <style>
        body {
            margin: 0;
            font-family: Arial, Helvetica, sans-serif;
            background: #0f1724;
            color: #e6eef6;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .app {
            width: 100%;
            max-width: 1000px;
            background: #1e293b;
            border-radius: 12px;
            padding: 22px;
            box-shadow: 0 10px 30px rgba(2, 6, 23, 0.6);
        }

        h1 {
            margin: 0 0 10px;
            font-size: 22px
        }

        p.lead {
            margin: 0 0 18px;
            color: #9aa4b2
        }

        .grid {
            display: grid;
            grid-template-columns: 1fr 380px;
            gap: 18px
        }

        .card {
            background: #0b1220;
            padding: 14px;
            border-radius: 10px
        }

        label {
            display: block;
            font-size: 13px;
            color: #9aa4b2;
            margin-bottom: 6px
        }

        input[type="number"] {
            width: 100%;
            padding: 10px;
            border-radius: 8px;
            border: 1px solid #334155;
            background: #1e293b;
            color: #fff;
            font-size: 14px
        }

        button {
            background: #3b82f6;
            border: none;
            padding: 10px 14px;
            border-radius: 8px;
            color: white;
            font-weight: 600;
            cursor: pointer
        }

        button.secondary {
            background: #334155
        }

        .result {
            margin-top: 12px;
            display: flex;
            flex-direction: column;
            gap: 8px
        }

        .item {
            display: flex;
            justify-content: space-between;
            padding: 8px;
            border-radius: 8px;
            background: #1e293b
        }

        .muted {
            color: #9aa4b2;
            font-size: 13px
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 12px;
            font-size: 13px
        }

        th,
        td {
            padding: 6px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            text-align: left
        }

        canvas {
            width: 100%;
            height: 160px;
            background: #1e293b;
            border-radius: 8px
        }
    </style>
</head>

<body>
    <div class="app">
        <h1>Titration Predictor</h1>
        <p class="lead">Predict burette readings and extracted acetic acid based on Acetic acid, Water, and Ethyl
            acetate.</p>

        <div class="grid">
            <div class="card">
                <div style="display:flex;gap:12px;align-items:center;margin-bottom:10px">
                    <div style="flex:1">
                        <label>Acetic acid (ml)</label>
                        <input id="inpAcetic" type="number" min="0" step="0.01" value="5">
                    </div>
                    <div style="flex:1">
                        <label>Water (ml)</label>
                        <input id="inpWater" type="number" min="0" step="0.01" value="95">
                    </div>
                    <div style="width:120px">
                        <label>Ethyl acetate (ml)</label>
                        <input id="inpEthyl" type="number" min="0" step="0.01" value="100">
                    </div>
                </div>

                <div style="display:flex;gap:10px;margin-bottom:10px">
                    <button id="btnPredict">Predict</button>
                    <button id="btnReset" class="secondary">Reset</button>
                </div>

                <div id="results" class="result"></div>
            </div>

            <div class="card">
                <strong>Dataset (15 samples)</strong>
                <div style="margin-top:8px;max-height:300px;overflow:auto">
                    <table id="dataTable">
                        <thead>
                            <tr>
                                <th>#</th>
                                <th>Acetic</th>
                                <th>Water</th>
                                <th>Ethyl</th>
                                <th>Burette Aq</th>
                                <th>Burette Org</th>
                                <th>Extract Aq</th>
                                <th>Extract Org</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
                <canvas id="chart"></canvas>
            </div>
        </div>
    </div>

    <script>
        // dataset from your table
        const dataset = [
            [1, 99, 100, 9.2, 8.7, 0.5139664804, 0.4860335196],
            [2, 98, 100, 17.6, 16.5, 1.032258065, 0.967741935],
            [3, 97, 100, 26.2, 21.5, 1.647798742, 1.352201258],
            [4, 96, 100, 38.1, 32.43, 2.160782646, 1.839217354],
            [5, 95, 100, 45.1, 39.3, 2.671800948, 2.328199052],
            [6, 94, 100, 57.6, 46.8, 3.310344828, 2.689655172],
            [7, 93, 100, 67.02, 54.52, 3.859963798, 3.140036202],
            [8, 92, 100, 76.68, 62.23, 4.416096753, 3.583903247],
            [9, 91, 100, 86.34, 69.94, 4.972229332, 4.027770668],
            [10, 90, 100, 96, 77.65, 5.528361647, 4.471638353],
            [11, 89, 100, 105.66, 85.36, 6.08449377, 4.91550623],
            [12, 88, 100, 115.32, 93.07, 6.64062575, 5.35937425],
            [13, 87, 100, 124.98, 100.78, 7.196757619, 5.803242381],
            [14, 86, 100, 134.64, 108.49, 7.752889401, 6.247110599],
            [15, 85, 100, 144.3, 116.2, 8.309021113, 6.690978887]
        ];

        // utilities
        function transpose(A) { return A[0].map((_, i) => A.map(r => r[i])); }
        function matMul(A, B) { return A.map(r => B[0].map((_, j) => r.reduce((s, _, k) => s + r[k] * B[k][j], 0))); }
        function invert(A) {
            const n = A.length; const M = A.map((r, i) => r.concat(Array.from({ length: n }, (_, j) => i === j ? 1 : 0)));
            for (let i = 0; i < n; i++) {
                let piv = i; for (let r = i; r < n; r++)if (Math.abs(M[r][i]) > Math.abs(M[piv][i])) piv = r;
                if (Math.abs(M[piv][i]) < 1e-12) throw Error("Singular");
                if (piv !== i) [M[i], M[piv]] = [M[piv], M[i]];
                let div = M[i][i]; for (let c = 0; c < 2 * n; c++)M[i][c] /= div;
                for (let r = 0; r < n; r++) { if (r === i) continue; let f = M[r][i]; for (let c = 0; c < 2 * n; c++)M[r][c] -= f * M[i][c]; }
            }
            return M.map(r => r.slice(n));
        }
        function normalEqn(X, y) {
            const XT = transpose(X), XTX = matMul(XT, X), XTy = matMul(XT, y);
            try { return matMul(invert(XTX), XTy); } catch {
                const n = XTX.length, lambda = 1e-6;
                const XTXreg = XTX.map((row, i) => row.map((v, j) => v + (i === j ? lambda : 0)));
                return matMul(invert(XTXreg), XTy);
            }
        }
        function predict(theta, feats) { return theta.reduce((s, t, i) => s + t[0] * feats[i], 0); }

        // build dataset
        const X = dataset.map(r => [1, r[0], r[1], r[2]]);
        const yAq = dataset.map(r => [r[3]]);
        const yOrg = dataset.map(r => [r[4]]);
        const yExAq = dataset.map(r => [r[5]]);
        const yExOrg = dataset.map(r => [r[6]]);
        const thetaAq = normalEqn(X, yAq);
        const thetaOrg = normalEqn(X, yOrg);
        const thetaExAq = normalEqn(X, yExAq);
        const thetaExOrg = normalEqn(X, yExOrg);

        // table
        const tbody = document.querySelector("#dataTable tbody");
        dataset.forEach((r, i) => {
            const tr = document.createElement("tr");
            tr.innerHTML = `<td>${i + 1}</td><td>${r[0]}</td><td>${r[1]}</td><td>${r[2]}</td>
    <td>${r[3]}</td><td>${r[4]}</td><td>${r[5].toFixed(6)}</td><td>${r[6].toFixed(6)}</td>`;
            tbody.appendChild(tr);
        });

        // predict button
        const res = document.getElementById("results");
        document.getElementById("btnPredict").onclick = () => {
            const a = parseFloat(document.getElementById("inpAcetic").value || 0);
            const w = parseFloat(document.getElementById("inpWater").value || 0);
            const e = parseFloat(document.getElementById("inpEthyl").value || 0);
            const feats = [1, a, w, e];

            const bqA = Math.max(0, predict(thetaAq, feats));
            const bqO = Math.max(0, predict(thetaOrg, feats));
            const exA = Math.max(0, predict(thetaExAq, feats));
            const exO = Math.max(0, predict(thetaExOrg, feats));

            res.innerHTML = `
    <div class="item"><span>Burette Reading — Aqueous</span><strong>${bqA.toFixed(3)}</strong></div>
    <div class="item"><span>Burette Reading — Organic</span><strong>${bqO.toFixed(3)}</strong></div>
    <div class="item"><span>Extracted Acetic Acid — Aqueous</span><strong>${exA.toFixed(6)}</strong></div>
    <div class="item"><span>Extracted Acetic Acid — Organic</span><strong>${exO.toFixed(6)}</strong></div>
    <div class="item"><span>Total Extracted</span><strong>${(exA + exO).toFixed(6)}</strong></div>
    <div class="item"><span>Total Burette Reading</span><strong>${(bqA + bqO).toFixed(3)}</strong></div>
  `;
            drawChart(a, bqA, bqO);
        };
        document.getElementById("btnReset").onclick = () => { res.innerHTML = ""; };

        // chart
        function drawChart(predAcetic, pAq, pOrg) {
            const canvas = document.getElementById("chart"), ctx = canvas.getContext("2d");
            canvas.width = canvas.clientWidth; canvas.height = canvas.clientHeight; ctx.clearRect(0, 0, canvas.width, canvas.height);
            const xs = dataset.map(r => r[0]), yA = dataset.map(r => r[3]), yO = dataset.map(r => r[4]);
            const xmin = Math.min(...xs) - 1, xmax = Math.max(...xs) + 1, ymin = 0, ymax = Math.max(...yA.concat(yO)) * 1.1;
            function sx(x) { return (x - xmin) / (xmax - xmin) * canvas.width; }
            function sy(y) { return canvas.height - (y - ymin) / (ymax - ymin) * canvas.height; }
            ctx.fillStyle = "blue"; yA.forEach((y, i) => { ctx.beginPath(); ctx.arc(sx(xs[i]), sy(y), 3, 0, 2 * Math.PI); ctx.fill(); });
            ctx.fillStyle = "green"; yO.forEach((y, i) => { ctx.beginPath(); ctx.arc(sx(xs[i]), sy(y), 3, 0, 2 * Math.PI); ctx.fill(); });
            if (predAcetic !== undefined) {
                ctx.fillStyle = "yellow";
                ctx.beginPath(); ctx.arc(sx(predAcetic), sy(pAq), 5, 0, 2 * Math.PI); ctx.fill();
                ctx.beginPath(); ctx.arc(sx(predAcetic), sy(pOrg), 5, 0, 2 * Math.PI); ctx.fill();
            }
        }
    </script>
</body>

</html>